{"version":3,"file":"static/chunks/5895.c9a7a965a399ac1d.js","mappings":"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","sources":["webpack://_N_E/./components/SvgContainer/styled.ts","webpack://_N_E/./containers/Home/components/Collaboration/CommentScene/styled.ts","webpack://_N_E/./containers/Home/hook/useCommentScene.tsx","webpack://_N_E/<anon>"],"sourcesContent":["/**\n *\n * styled SvgContainer\n *\n */\nimport styled from 'styled-components';\n\nexport const SvgContainerWrapper = styled.div`\n  width: 100%;\n  height: 100%;\n  svg {\n    width: 100%;\n    height: 100%;\n  }\n`;\n","import { SvgContainerWrapper } from '@components/SvgContainer/styled';\nimport { FlexRowBetween, FlexRowCenter } from '@styles/global-styles';\nimport styled from 'styled-components';\n\nexport const CommentSceneIconWrapper = styled.div`\n  width: 42px;\n  height: auto;\n  display: inline-flex;\n  position: relative;\n  &.resolved {\n    transform: scale(0.85);\n    opacity: 0.75;\n  }\n  ${SvgContainerWrapper} {\n    height: auto;\n    path {\n      fill: rgb(250 173 20 / 80%);\n      stroke: #fff;\n      stroke-width: 2;\n    }\n  }\n  .--icon {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-flex;\n    align-items: center;\n    color: #fff;\n    font-weight: 600;\n  }\n  &.resolved {\n    .--icon {\n      i {\n        font-size: 18px;\n      }\n    }\n    svg {\n      path {\n        fill: rgba(46, 194, 106, 0.8);\n        stroke: #fff;\n        stroke-width: 2;\n      }\n    }\n  }\n`;\n\nexport const CommentSceneItemWrapper = styled.div`\n  width: 100%;\n  color: #ffffff;\n  display: flex;\n  .--main {\n    width: 100%;\n  }\n\n  .countComment {\n    width: max-content;\n    padding: 4px 6px;\n    background: var(--color-dark-2);\n    display: flex;\n    border-radius: 4px;\n    cursor: pointer;\n    align-items: center;\n    i {\n      margin-right: 8px;\n    }\n    span {\n      opacity: 0.5;\n    }\n    &:hover {\n      span {\n        opacity: 1;\n      }\n    }\n  }\n\n  &.parent-layout {\n    .--main {\n      .user {\n        display: flex;\n        .avt {\n          margin-right: 8px;\n          flex: 0 0 auto;\n          img {\n            width: 42px;\n            height: 42px;\n            object-fit: cover;\n            border-radius: 50%;\n            background: #ffffff;\n          }\n        }\n        .info {\n          .name {\n            font-weight: 600;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            max-width: 150px;\n          }\n          .time {\n            color: var(--color-smoke);\n            font-size: 12px;\n          }\n        }\n      }\n      .txt {\n        margin: 8px 0;\n      }\n    }\n  }\n  &.children-layout {\n    .--main {\n      display: flex;\n      align-items: flex-start;\n      .avt {\n        margin-right: 12px;\n        border-radius: 50%;\n        overflow: hidden;\n        background: #ffffff;\n        flex: 0 0 auto;\n        img {\n          width: 42px;\n          height: 42px;\n          object-fit: cover;\n        }\n      }\n      .content {\n        background: rgba(0, 0, 0, 0.5);\n        border-radius: 8px;\n        padding: 8px 12px;\n        width: 100%;\n        .info {\n          display: flex;\n          align-items: flex-end;\n          .name {\n            font-weight: 600;\n            font-size: 15px;\n          }\n          .time {\n            color: #969fa7;\n            font-size: 12px;\n            margin-left: 8px;\n          }\n        }\n        .txt {\n          margin: 6px 0 3px;\n        }\n      }\n    }\n    &:not(:last-child) {\n      margin-bottom: 12px;\n    }\n    &:last-child {\n      margin-bottom: 8px;\n    }\n  }\n  .--extra {\n    flex: 0 0 auto;\n    margin-left: 8px;\n    i {\n      cursor: pointer;\n      &:after {\n        position: absolute;\n        content: '';\n        width: 24px;\n        height: 24px;\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 2;\n      }\n    }\n  }\n`;\n\nexport const CommentBoxWrapper = styled.div`\n  margin: 8px 0;\n  textarea {\n    width: 100%;\n    border: 1px solid rgba(255, 255, 255, 0.25);\n    outline: none !important;\n    box-shadow: none !important;\n    padding: 0.25rem 0.5rem;\n    width: 100%;\n    color: #fff;\n    // font-size: 14px;\n    // font-weight: 400;\n    background-color: var(--color-dark);\n    resize: none;\n    border-radius: 4px;\n    color: inherit;\n    max-height: 250px !important;\n    user-select: all;\n    &::placeholder {\n      opacity: 0.5;\n      color: rgba(255, 255, 255, 0.57);\n      font-size: 14px;\n    }\n    &:hover {\n      border-color: rgb(255 255 255 / 0.5);\n    }\n    &:focus {\n      border-color: #ffffff50;\n      background-color: rgb(0 0 0 / 0.5);\n    }\n    &:active {\n    }\n    &[disabled] {\n      background-color: rgba(0, 0, 0, 0.25);\n      color: rgba(255, 255, 255, 0.75);\n    }\n  }\n  .--bottom {\n    ${FlexRowBetween};\n    color: #fff;\n    .act {\n      &-extra {\n        i {\n          cursor: pointer;\n        }\n      }\n      &-main {\n        .--btn {\n          border: none;\n          height: auto;\n          padding: 4px 12px;\n          border-radius: 4px;\n          span {\n            margin-left: 4px;\n          }\n          &.--submit {\n            margin-right: 8px;\n            background-color: var(--color-theme);\n            color: #fff;\n          }\n          &.--cancel {\n            background-color: var(--color-dark-2);\n            color: var(--color-smoke);\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport const CommentScenePopoverWrapper = styled.div`\n  width: 400px;\n  padding: 16px 16px 0;\n  background: rgb(33 33 33 / 80%);\n  position: relative;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.75);\n  .--parent {\n    ${CommentSceneItemWrapper} {\n      .--action {\n        margin-top: 8px;\n        .ant-btn {\n          background: rgb(47 208 172 / 20%);\n          border-radius: 6px;\n          height: auto;\n          color: var(--color-green);\n          border: 1px solid var(--color-green);\n          padding: 4px 8px;\n          span {\n            margin-left: 8px;\n          }\n          &[disabled] {\n            background: var(--color-green);\n            color: #fff;\n          }\n        }\n      }\n      padding-bottom: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.25);\n    }\n  }\n  .--children {\n    margin-top: 12px;\n    max-height: 350px;\n    overflow: auto;\n  }\n  .--add-new {\n    border-top: 1px solid rgba(255, 255, 255, 0.4);\n    border-radius: 0 0 12px 12px;\n    margin-left: -16px;\n    width: calc(100% + 32px);\n    padding: 12px 16px;\n    background: var(--color-dark);\n    color: #fff;\n    ${CommentBoxWrapper} {\n      margin: 0;\n    }\n  }\n  .--close {\n    position: absolute;\n    right: -10px;\n    top: -10px;\n    width: 24px;\n    height: 24px;\n    background: #fff;\n    color: #333;\n    border-radius: 50%;\n    ${FlexRowCenter};\n    cursor: pointer;\n    i {\n    }\n  }\n`;\n\nexport const DialogCreateCommentSceneWrapper = styled.div`\n  padding: 16px;\n  background: var(--color-dark);\n  border-radius: 16px;\n  border: 1px solid rgba(255, 255, 255, 0.25);\n  .--icon-close {\n    position: absolute;\n    background: transparent;\n    color: #fff;\n    right: 6px;\n    top: 10px;\n    box-shadow: none;\n  }\n  .header {\n    ${FlexRowBetween}\n    .title {\n      color: #fff;\n      font-weight: 600;\n    }\n  }\n  .popover {\n    margin: 16px 0 0;\n    position: relative;\n    ${CommentBoxWrapper} {\n      margin-bottom: 0;\n      color: #fff;\n    }\n  }\n`;\n","/* eslint-disable prefer-destructuring */\nimport { Type_RefFuncKrpano } from '@components/Krpano/types';\nimport { RequireSomeField } from '@type/customType';\nimport { BaseXHR } from '@utils/axios';\nimport { useCallback, useEffect, useMemo, useRef } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useCollaborationMode } from '../global/TourStats';\nimport {\n  selectToken,\n  selectInfoUser,\n  selectIsOwnerTour,\n  selectListCommentSceneSelected,\n  selectIsAllowToAccessOnCollaborationMode,\n} from '../selectors';\nimport { actions } from '../slice';\nimport { I_CommentScene, I_PayloadCommentScene } from '../types';\n\nexport const useCommentScene = () => {\n  const dispatch = useDispatch();\n  const token = useSelector(selectToken);\n  const listCommentSceneSelected = useSelector(selectListCommentSceneSelected);\n  const infoUser = useSelector(selectInfoUser);\n  const isOwnerTour = useSelector(selectIsOwnerTour);\n  const isAllowToAccessOnCollaborationMode = useSelector(\n    selectIsAllowToAccessOnCollaborationMode,\n  );\n\n  const listCommentSceneGroupByParentRef = useRef<I_CommentScene[]>([]);\n\n  const [krpanoInstance] = useCollaborationMode('krpanoRef');\n  const [, setCommentSceneSelected] = useCollaborationMode(\n    'commentSceneSelected',\n  );\n  const [, setIsShowDialogCreateCommentScene] = useCollaborationMode(\n    'isShowDialogCreateCommentScene',\n  );\n  const [, setLoading] = useCollaborationMode('loading');\n\n  const listCommentSceneGroupByParent = useMemo(\n    () =>\n      listCommentSceneSelected\n        ?.filter(item => !item.parent)\n        ?.slice()\n        ?.sort((a, b) => a.created_at.localeCompare(b.created_at))\n        ?.map((item, index) => ({\n          ...item,\n          index: index + 1,\n          isOwnerTour,\n          isOwnerComment: item.user?.id === infoUser?.id,\n          children:\n            listCommentSceneSelected\n              ?.filter(el => el.parent === item.id)\n              ?.map(el => ({\n                ...el,\n                isOwnerTour,\n                isOwnerComment: el.user?.id === infoUser?.id,\n              }))\n              ?.slice()\n              ?.sort((a, b) => b.created_at.localeCompare(a.created_at)) || [],\n        })) || [],\n    [infoUser?.id, isOwnerTour, listCommentSceneSelected],\n  );\n\n  const listCommentSceneGroupByParentResolved = useMemo(\n    () => listCommentSceneGroupByParent.filter(item => !!item.isResolved),\n    [listCommentSceneGroupByParent],\n  );\n\n  const listCommentSceneGroupByParentActive = useMemo(\n    () => listCommentSceneGroupByParent.filter(item => !item.isResolved),\n    [listCommentSceneGroupByParent],\n  );\n\n  useEffect(() => {\n    listCommentSceneGroupByParentRef.current = listCommentSceneGroupByParent;\n  }, [listCommentSceneGroupByParent]);\n\n  const onRequestAccessCollaboration = useCallback(\n    async (project_id: string) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$post(\n          '/comment-scene/send-request-access-collab',\n          { project_id },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        );\n        return data;\n      } finally {\n        setLoading(false);\n      }\n    },\n    [token, setLoading],\n  );\n\n  const onCreateCommentScene = useCallback(\n    async (\n      payload: Omit<I_PayloadCommentScene, 'id' | 'children'>,\n      instanceKrpano: Type_RefFuncKrpano | null = krpanoInstance,\n    ) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$post('/comment-scene/create', payload, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n        dispatch(actions.createCommentScene(data.data));\n\n        let newData;\n        if (data.data.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.parent,\n            )[0];\n          newData = {\n            ...commentSelected,\n            children: [\n              { ...data.data, isOwnerTour, isOwnerComment: true },\n              ...(commentSelected.children || []),\n            ],\n          };\n          if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n        } else {\n          newData = {\n            ...data.data,\n            isOwnerTour,\n            isOwnerComment: true,\n            index: listCommentSceneGroupByParentRef.current.length + 1,\n          };\n          newData.children = [];\n          if (instanceKrpano) instanceKrpano.onAddCommentScene(newData);\n        }\n        setIsShowDialogCreateCommentScene(false);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [\n      token,\n      dispatch,\n      setLoading,\n      isOwnerTour,\n      krpanoInstance,\n      setIsShowDialogCreateCommentScene,\n    ],\n  );\n\n  const onUpdateCommentScene = useCallback(\n    async (\n      payload: RequireSomeField<I_PayloadCommentScene, 'id'>,\n      instanceKrpano: Type_RefFuncKrpano | null = krpanoInstance,\n    ) => {\n      setLoading(true);\n      try {\n        const { data } = await BaseXHR.$put('/comment-scene/update', payload, {\n          headers: {\n            Authorization: `Bearer ${token}`,\n          },\n        });\n        dispatch(actions.updateCommentScene(data.data));\n\n        let newData;\n        if (data.data.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.parent,\n            )[0];\n          newData = commentSelected;\n          newData.children = newData.children.map(item =>\n            item.id === data.data.id\n              ? {\n                  ...data.data,\n                  children: [],\n                  isOwnerTour,\n                  isOwnerComment: true,\n                }\n              : item,\n          );\n        } else {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === data.data.id,\n            )[0];\n          newData = {\n            ...commentSelected,\n            ...data.data,\n            isOwnerTour,\n            isOwnerComment: true,\n          };\n        }\n        if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [krpanoInstance, setLoading, token, dispatch, isOwnerTour],\n  );\n\n  const onDeleteCommentScene = useCallback(\n    async (\n      payload: I_CommentScene,\n      instanceKrpano: Type_RefFuncKrpano | null = krpanoInstance,\n      isClosePopoverOnKrpano = false,\n    ) => {\n      setLoading(true);\n      try {\n        await BaseXHR.$delete(\n          '/comment-scene/delete',\n          { id: payload.id },\n          {\n            headers: {\n              Authorization: `Bearer ${token}`,\n            },\n          },\n        );\n        dispatch(actions.deleteCommentScene(payload));\n\n        let newData;\n        if (payload.parent) {\n          const commentSelected =\n            listCommentSceneGroupByParentRef.current.filter(\n              item => item.id === payload.parent,\n            )[0];\n          newData = commentSelected;\n          newData.children = newData.children.filter(\n            item => item.id !== payload.id,\n          );\n          if (instanceKrpano) instanceKrpano.onReplaceCommentScene(newData);\n        } else if (instanceKrpano)\n          instanceKrpano.onRemoveCommentScene(payload.id);\n\n        if (isClosePopoverOnKrpano) setCommentSceneSelected(null);\n      } finally {\n        setLoading(false);\n      }\n    },\n    [token, dispatch, setLoading, krpanoInstance, setCommentSceneSelected],\n  );\n\n  return useMemo(\n    () => ({\n      isOwnerTour,\n      onCreateCommentScene,\n      onUpdateCommentScene,\n      onDeleteCommentScene,\n      listCommentSceneGroupByParent,\n      onRequestAccessCollaboration,\n      isAllowToAccessOnCollaborationMode,\n      listCommentSceneGroupByParentActive,\n      listCommentSceneGroupByParentResolved,\n    }),\n    [\n      isOwnerTour,\n      onCreateCommentScene,\n      onUpdateCommentScene,\n      onDeleteCommentScene,\n      onRequestAccessCollaboration,\n      listCommentSceneGroupByParent,\n      isAllowToAccessOnCollaborationMode,\n      listCommentSceneGroupByParentActive,\n      listCommentSceneGroupByParentResolved,\n    ],\n  );\n};\n"],"names":["SvgContainerWrapper","styled","div","withConfig","CommentSceneIconWrapper","CommentSceneItemWrapper","CommentBoxWrapper","FlexRowBetween","CommentScenePopoverWrapper","FlexRowCenter","DialogCreateCommentSceneWrapper","useCommentScene","dispatch","useDispatch","token","useSelector","selectToken","listCommentSceneSelected","selectListCommentSceneSelected","infoUser","selectInfoUser","isOwnerTour","selectIsOwnerTour","isAllowToAccessOnCollaborationMode","selectIsAllowToAccessOnCollaborationMode","listCommentSceneGroupByParentRef","useRef","krpanoInstance","useCollaborationMode","setCommentSceneSelected","setIsShowDialogCreateCommentScene","setLoading","listCommentSceneGroupByParent","useMemo","filter","item","parent","slice","sort","a","b","created_at","localeCompare","map","index","_swc_helpers_object_spread_props__WEBPACK_IMPORTED_MODULE_7__","_","_swc_helpers_object_spread__WEBPACK_IMPORTED_MODULE_8__","isOwnerComment","user","id","children","el","listCommentSceneGroupByParentResolved","isResolved","listCommentSceneGroupByParentActive","useEffect","current","onRequestAccessCollaboration","useCallback","_swc_helpers_async_to_generator__WEBPACK_IMPORTED_MODULE_9__","project_id","BaseXHR","$post","headers","Authorization","concat","_state","sent","data","onCreateCommentScene","payload","instanceKrpano","newData","commentSelected","actions","createCommentScene","_swc_helpers_to_consumable_array__WEBPACK_IMPORTED_MODULE_11__","onReplaceCommentScene","length","onAddCommentScene","onUpdateCommentScene","$put","updateCommentScene","onDeleteCommentScene","isClosePopoverOnKrpano","$delete","deleteCommentScene","onRemoveCommentScene"],"sourceRoot":""}