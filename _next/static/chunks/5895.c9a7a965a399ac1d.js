"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5895],{55139:function(n,e,t){t.d(e,{N:function(){return o}});var r=t(82729);function _templateObject(){var n=(0,r._)(["\n  width: 100%;\n  height: 100%;\n  svg {\n    width: 100%;\n    height: 100%;\n  }\n"]);return _templateObject=function(){return n},n}var o=t(94589).ZP.div.withConfig({displayName:"styled__SvgContainerWrapper",componentId:"Panoee__sc-7ab11388-0"})(_templateObject())},24018:function(n,e,t){t.d(e,{Bo:function(){return u},Ck:function(){return s},RL:function(){return d},TM:function(){return c},s2:function(){return l}});var r=t(82729),o=t(55139),i=t(72071),a=t(94589);function _templateObject(){var n=(0,r._)(["\n  width: 42px;\n  height: auto;\n  display: inline-flex;\n  position: relative;\n  &.resolved {\n    transform: scale(0.85);\n    opacity: 0.75;\n  }\n  "," {\n    height: auto;\n    path {\n      fill: rgb(250 173 20 / 80%);\n      stroke: #fff;\n      stroke-width: 2;\n    }\n  }\n  .--icon {\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    display: inline-flex;\n    align-items: center;\n    color: #fff;\n    font-weight: 600;\n  }\n  &.resolved {\n    .--icon {\n      i {\n        font-size: 18px;\n      }\n    }\n    svg {\n      path {\n        fill: rgba(46, 194, 106, 0.8);\n        stroke: #fff;\n        stroke-width: 2;\n      }\n    }\n  }\n"]);return _templateObject=function(){return n},n}function _templateObject1(){var n=(0,r._)(["\n  width: 100%;\n  color: #ffffff;\n  display: flex;\n  .--main {\n    width: 100%;\n  }\n\n  .countComment {\n    width: max-content;\n    padding: 4px 6px;\n    background: var(--color-dark-2);\n    display: flex;\n    border-radius: 4px;\n    cursor: pointer;\n    align-items: center;\n    i {\n      margin-right: 8px;\n    }\n    span {\n      opacity: 0.5;\n    }\n    &:hover {\n      span {\n        opacity: 1;\n      }\n    }\n  }\n\n  &.parent-layout {\n    .--main {\n      .user {\n        display: flex;\n        .avt {\n          margin-right: 8px;\n          flex: 0 0 auto;\n          img {\n            width: 42px;\n            height: 42px;\n            object-fit: cover;\n            border-radius: 50%;\n            background: #ffffff;\n          }\n        }\n        .info {\n          .name {\n            font-weight: 600;\n            white-space: nowrap;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            max-width: 150px;\n          }\n          .time {\n            color: var(--color-smoke);\n            font-size: 12px;\n          }\n        }\n      }\n      .txt {\n        margin: 8px 0;\n      }\n    }\n  }\n  &.children-layout {\n    .--main {\n      display: flex;\n      align-items: flex-start;\n      .avt {\n        margin-right: 12px;\n        border-radius: 50%;\n        overflow: hidden;\n        background: #ffffff;\n        flex: 0 0 auto;\n        img {\n          width: 42px;\n          height: 42px;\n          object-fit: cover;\n        }\n      }\n      .content {\n        background: rgba(0, 0, 0, 0.5);\n        border-radius: 8px;\n        padding: 8px 12px;\n        width: 100%;\n        .info {\n          display: flex;\n          align-items: flex-end;\n          .name {\n            font-weight: 600;\n            font-size: 15px;\n          }\n          .time {\n            color: #969fa7;\n            font-size: 12px;\n            margin-left: 8px;\n          }\n        }\n        .txt {\n          margin: 6px 0 3px;\n        }\n      }\n    }\n    &:not(:last-child) {\n      margin-bottom: 12px;\n    }\n    &:last-child {\n      margin-bottom: 8px;\n    }\n  }\n  .--extra {\n    flex: 0 0 auto;\n    margin-left: 8px;\n    i {\n      cursor: pointer;\n      &:after {\n        position: absolute;\n        content: '';\n        width: 24px;\n        height: 24px;\n        left: 50%;\n        top: 50%;\n        transform: translate(-50%, -50%);\n        z-index: 2;\n      }\n    }\n  }\n"]);return _templateObject1=function(){return n},n}function _templateObject2(){var n=(0,r._)(["\n  margin: 8px 0;\n  textarea {\n    width: 100%;\n    border: 1px solid rgba(255, 255, 255, 0.25);\n    outline: none !important;\n    box-shadow: none !important;\n    padding: 0.25rem 0.5rem;\n    width: 100%;\n    color: #fff;\n    // font-size: 14px;\n    // font-weight: 400;\n    background-color: var(--color-dark);\n    resize: none;\n    border-radius: 4px;\n    color: inherit;\n    max-height: 250px !important;\n    user-select: all;\n    &::placeholder {\n      opacity: 0.5;\n      color: rgba(255, 255, 255, 0.57);\n      font-size: 14px;\n    }\n    &:hover {\n      border-color: rgb(255 255 255 / 0.5);\n    }\n    &:focus {\n      border-color: #ffffff50;\n      background-color: rgb(0 0 0 / 0.5);\n    }\n    &:active {\n    }\n    &[disabled] {\n      background-color: rgba(0, 0, 0, 0.25);\n      color: rgba(255, 255, 255, 0.75);\n    }\n  }\n  .--bottom {\n    ",";\n    color: #fff;\n    .act {\n      &-extra {\n        i {\n          cursor: pointer;\n        }\n      }\n      &-main {\n        .--btn {\n          border: none;\n          height: auto;\n          padding: 4px 12px;\n          border-radius: 4px;\n          span {\n            margin-left: 4px;\n          }\n          &.--submit {\n            margin-right: 8px;\n            background-color: var(--color-theme);\n            color: #fff;\n          }\n          &.--cancel {\n            background-color: var(--color-dark-2);\n            color: var(--color-smoke);\n          }\n        }\n      }\n    }\n  }\n"]);return _templateObject2=function(){return n},n}function _templateObject3(){var n=(0,r._)(["\n  width: 400px;\n  padding: 16px 16px 0;\n  background: rgb(33 33 33 / 80%);\n  position: relative;\n  border-radius: 12px;\n  border: 1px solid rgba(255, 255, 255, 0.75);\n  .--parent {\n    "," {\n      .--action {\n        margin-top: 8px;\n        .ant-btn {\n          background: rgb(47 208 172 / 20%);\n          border-radius: 6px;\n          height: auto;\n          color: var(--color-green);\n          border: 1px solid var(--color-green);\n          padding: 4px 8px;\n          span {\n            margin-left: 8px;\n          }\n          &[disabled] {\n            background: var(--color-green);\n            color: #fff;\n          }\n        }\n      }\n      padding-bottom: 12px;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.25);\n    }\n  }\n  .--children {\n    margin-top: 12px;\n    max-height: 350px;\n    overflow: auto;\n  }\n  .--add-new {\n    border-top: 1px solid rgba(255, 255, 255, 0.4);\n    border-radius: 0 0 12px 12px;\n    margin-left: -16px;\n    width: calc(100% + 32px);\n    padding: 12px 16px;\n    background: var(--color-dark);\n    color: #fff;\n    "," {\n      margin: 0;\n    }\n  }\n  .--close {\n    position: absolute;\n    right: -10px;\n    top: -10px;\n    width: 24px;\n    height: 24px;\n    background: #fff;\n    color: #333;\n    border-radius: 50%;\n    ",";\n    cursor: pointer;\n    i {\n    }\n  }\n"]);return _templateObject3=function(){return n},n}function _templateObject4(){var n=(0,r._)(["\n  padding: 16px;\n  background: var(--color-dark);\n  border-radius: 16px;\n  border: 1px solid rgba(255, 255, 255, 0.25);\n  .--icon-close {\n    position: absolute;\n    background: transparent;\n    color: #fff;\n    right: 6px;\n    top: 10px;\n    box-shadow: none;\n  }\n  .header {\n    ","\n    .title {\n      color: #fff;\n      font-weight: 600;\n    }\n  }\n  .popover {\n    margin: 16px 0 0;\n    position: relative;\n    "," {\n      margin-bottom: 0;\n      color: #fff;\n    }\n  }\n"]);return _templateObject4=function(){return n},n}var c=a.ZP.div.withConfig({displayName:"styled__CommentSceneIconWrapper",componentId:"Panoee__sc-29611543-0"})(_templateObject(),o.N),l=a.ZP.div.withConfig({displayName:"styled__CommentSceneItemWrapper",componentId:"Panoee__sc-29611543-1"})(_templateObject1()),d=a.ZP.div.withConfig({displayName:"styled__CommentBoxWrapper",componentId:"Panoee__sc-29611543-2"})(_templateObject2(),i.ep),u=a.ZP.div.withConfig({displayName:"styled__CommentScenePopoverWrapper",componentId:"Panoee__sc-29611543-3"})(_templateObject3(),l,d,i.b0),s=a.ZP.div.withConfig({displayName:"styled__DialogCreateCommentSceneWrapper",componentId:"Panoee__sc-29611543-4"})(_templateObject4(),i.ep,d)},83403:function(n,e,t){t.d(e,{d:function(){return useCommentScene}});var r=t(11010),o=t(72253),i=t(14932),a=t(91309),c=t(4586),l=t(97582),d=t(62633),u=t(67294),s=t(25617),p=t(58673),f=t(61935),m=t(1214),useCommentScene=function(){var n,e,t,h,b=(0,s.I0)(),g=(0,s.v9)(f.rK),x=(0,s.v9)(f.bn),v=(0,s.v9)(f.eu),_=(0,s.v9)(f.ej),w=(0,s.v9)(f.Iy),C=(0,u.useRef)([]),y=(0,a._)((0,p.yG)("krpanoRef"),1)[0],k=(0,a._)((0,p.yG)("commentSceneSelected"),2)[1],O=(0,a._)((0,p.yG)("isShowDialogCreateCommentScene"),2)[1],S=(0,a._)((0,p.yG)("loading"),2)[1],j=(0,u.useMemo)(function(){var n,e,t;return(null==x?void 0:null===(t=x.filter(function(n){return!n.parent}))||void 0===t?void 0:null===(e=t.slice())||void 0===e?void 0:null===(n=e.sort(function(n,e){return n.created_at.localeCompare(e.created_at)}))||void 0===n?void 0:n.map(function(n,e){var t,r,a,c;return(0,i._)((0,o._)({},n),{index:e+1,isOwnerTour:_,isOwnerComment:(null===(t=n.user)||void 0===t?void 0:t.id)===(null==v?void 0:v.id),children:(null==x?void 0:null===(c=x.filter(function(e){return e.parent===n.id}))||void 0===c?void 0:null===(a=c.map(function(n){var e;return(0,i._)((0,o._)({},n),{isOwnerTour:_,isOwnerComment:(null===(e=n.user)||void 0===e?void 0:e.id)===(null==v?void 0:v.id)})}))||void 0===a?void 0:null===(r=a.slice())||void 0===r?void 0:r.sort(function(n,e){return e.created_at.localeCompare(n.created_at)}))||[]})}))||[]},[null==v?void 0:v.id,_,x]),P=(0,u.useMemo)(function(){return j.filter(function(n){return!!n.isResolved})},[j]),R=(0,u.useMemo)(function(){return j.filter(function(n){return!n.isResolved})},[j]);(0,u.useEffect)(function(){C.current=j},[j]);var N=(0,u.useCallback)((n=(0,r._)(function(n){return(0,l.Jh)(this,function(e){switch(e.label){case 0:S(!0),e.label=1;case 1:return e.trys.push([1,,3,4]),[4,d.R.$post("/comment-scene/send-request-access-collab",{project_id:n},{headers:{Authorization:"Bearer ".concat(g)}})];case 2:return[2,e.sent().data];case 3:return S(!1),[7];case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),[g,S]),z=(0,u.useCallback)((e=(0,r._)(function(n){var e,t,r,a,u=arguments;return(0,l.Jh)(this,function(l){switch(l.label){case 0:e=u.length>1&&void 0!==u[1]?u[1]:y,S(!0),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,d.R.$post("/comment-scene/create",n,{headers:{Authorization:"Bearer ".concat(g)}})];case 2:return t=l.sent().data,b(m.Nw.createCommentScene(t.data)),t.data.parent?(a=C.current.filter(function(n){return n.id===t.data.parent})[0],r=(0,i._)((0,o._)({},a),{children:[(0,i._)((0,o._)({},t.data),{isOwnerTour:_,isOwnerComment:!0})].concat((0,c._)(a.children||[]))}),e&&e.onReplaceCommentScene(r)):((r=(0,i._)((0,o._)({},t.data),{isOwnerTour:_,isOwnerComment:!0,index:C.current.length+1})).children=[],e&&e.onAddCommentScene(r)),O(!1),[3,4];case 3:return S(!1),[7];case 4:return[2]}})}),function(n){return e.apply(this,arguments)}),[g,b,S,_,y,O]),I=(0,u.useCallback)((t=(0,r._)(function(n){var e,t,r,a,c=arguments;return(0,l.Jh)(this,function(l){switch(l.label){case 0:e=c.length>1&&void 0!==c[1]?c[1]:y,S(!0),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,d.R.$put("/comment-scene/update",n,{headers:{Authorization:"Bearer ".concat(g)}})];case 2:return t=l.sent().data,b(m.Nw.updateCommentScene(t.data)),t.data.parent?(r=C.current.filter(function(n){return n.id===t.data.parent})[0]).children=r.children.map(function(n){return n.id===t.data.id?(0,i._)((0,o._)({},t.data),{children:[],isOwnerTour:_,isOwnerComment:!0}):n}):(a=C.current.filter(function(n){return n.id===t.data.id})[0],r=(0,i._)((0,o._)({},a,t.data),{isOwnerTour:_,isOwnerComment:!0})),e&&e.onReplaceCommentScene(r),[3,4];case 3:return S(!1),[7];case 4:return[2]}})}),function(n){return t.apply(this,arguments)}),[y,S,g,b,_]),A=(0,u.useCallback)((h=(0,r._)(function(n){var e,t,r,o=arguments;return(0,l.Jh)(this,function(i){switch(i.label){case 0:e=o.length>1&&void 0!==o[1]?o[1]:y,t=o.length>2&&void 0!==o[2]&&o[2],S(!0),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,d.R.$delete("/comment-scene/delete",{id:n.id},{headers:{Authorization:"Bearer ".concat(g)}})];case 2:return i.sent(),b(m.Nw.deleteCommentScene(n)),n.parent?((r=C.current.filter(function(e){return e.id===n.parent})[0]).children=r.children.filter(function(e){return e.id!==n.id}),e&&e.onReplaceCommentScene(r)):e&&e.onRemoveCommentScene(n.id),t&&k(null),[3,4];case 3:return S(!1),[7];case 4:return[2]}})}),function(n){return h.apply(this,arguments)}),[g,b,S,y,k]);return(0,u.useMemo)(function(){return{isOwnerTour:_,onCreateCommentScene:z,onUpdateCommentScene:I,onDeleteCommentScene:A,listCommentSceneGroupByParent:j,onRequestAccessCollaboration:N,isAllowToAccessOnCollaborationMode:w,listCommentSceneGroupByParentActive:R,listCommentSceneGroupByParentResolved:P}},[_,z,I,A,N,j,w,R,P])}}}]);
//# sourceMappingURL=5895.c9a7a965a399ac1d.js.map